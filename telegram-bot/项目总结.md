# 🤖 AI 客服小安 - Telegram 智能客服系统

## 📋 项目信息

| 项目名称 | AI 客服小安 |
|---------|-----------|
| 服务对象 | 优质三方会员服务应用 |
| 技术栈 | Telegram Bot + OpenAI GPT-4o-mini + MongoDB |
| 部署方式 | Docker Compose |
| 配置日期 | 2025-11-15 |
| 状态 | ✅ 配置完成，可启动测试 |

## ⚡ 快速开始

```bash
# 1. 进入项目目录
cd telegram-bot

# 2. 启动服务
./start.sh

# 3. 查看日志
docker-compose logs -f bot

# 4. 测试机器人（在 Telegram 中）
# - 搜索你的机器人
# - 发送 /start
# - 测试对话
```

## 📁 项目结构

```
telegram-bot/
├── config/
│   ├── config.yaml              ✅ 实际配置（已填写）
│   └── config-sample.yaml       📝 配置模板（参考）
├── docker-compose.yml           🐳 Docker 编排
├── start.sh                     🚀 启动脚本
├── stop.sh                      🛑 停止脚本
├── README.md                    📖 项目说明
├── 使用指南.md                  📚 详细文档
└── 测试清单.md                  ✅ 测试步骤
```

## 🔑 关键配置

### Telegram
```yaml
bot_token: '8584335653:AAFxKjEZBD-w98XJG26TmxaliC-Yb5'
owner_id: '6919196077'
staffchat_id: '-10034038523'
```

### OpenAI
```yaml
use_llm: true
llm_model: 'gpt-4o-mini'
llm_api_key: 'sk-proj-HPP9...'  # 已配置
```

### 功能开关
```yaml
show_auto_replied: true      # ✅ 显示 AI 标记
show_user_ticket: true       # ✅ 显示工单号
anonymous_tickets: false     # ❌ 不匿名（显示用户名）
```

## ✨ 核心功能

### 🤖 AI 智能回复
- **模型**: GPT-4o-mini（快速且经济）
- **语言**: 简体中文
- **角色**: AI 客服小安
- **特点**:
  - 24/7 在线响应
  - 自动生成客服记录表
  - 智能填写会员注册表、退款申请表
  - 不确定时提示联系管理员

### 👥 工单系统
- 用户消息自动创建工单
- 工单号格式: `#T000001`
- 实时转发到客服群组
- 支持关闭、重开、追踪

### 🔄 人机协作
- AI 初步响应常见问题
- 客服群组实时监控
- 复杂问题人工介入
- 无缝切换体验

### 📊 数据管理
- MongoDB 存储对话记录
- 支持备份和恢复
- 工单状态追踪
- 用户历史查询

## 📝 使用场景

| 场景 | AI 处理 | 人工处理 |
|------|--------|---------|
| 常见问题咨询 | ✅ 自动回复 | - |
| 会员注册引导 | ✅ 收集信息 | ✅ 最终确认 |
| 退款申请 | ✅ 表单填写 | ✅ 审批处理 |
| 价格咨询 | ❌ 转人工 | ✅ 报价 |
| 复杂问题 | ⚠️ 初步解答 | ✅ 深度支持 |

## 📖 文档导航

### 🚀 新手入门
1. **README.md** - 项目概述和快速开始
2. **测试清单.md** - 跟着步骤测试功能

### 📚 深度使用
3. **使用指南.md** - 完整操作手册
   - 系统架构
   - 管理操作
   - 故障排查
   - 性能优化

### 🔧 配置参考
4. **config/config-sample.yaml** - 配置模板说明
5. **config/config.yaml** - 实际运行配置

## 🎯 测试步骤（5 分钟快速测试）

### 1️⃣ 启动服务
```bash
./start.sh
```

### 2️⃣ 用户端测试
- 在 Telegram 找到你的机器人
- 发送 `/start`
- 发送 `你好` 测试 AI
- 发送 `我想注册` 测试场景

### 3️⃣ 客服端测试
- 进入客服群组（-10034038523）
- 查看用户消息是否转发
- 回复一条消息测试
- 发送 `/open` 查看工单

### 4️⃣ 确认成功
- [x] 用户能收到 AI 回复
- [x] 客服组能看到消息
- [x] 人工回复能送达用户
- [x] 工单系统正常工作

## 🔧 常用命令

### 服务管理
```bash
./start.sh                   # 启动服务
./stop.sh                    # 停止服务
docker-compose ps            # 查看状态
docker-compose logs -f bot   # 查看日志
docker-compose restart bot   # 重启 Bot
```

### 用户命令（在 Telegram 中）
```
/start  - 开始使用
/help   - 查看帮助
/faq    - 常见问题
/id     - 查看 ID
```

### 客服命令（在客服群组）
```
/open   - 查看未处理工单
/close  - 关闭当前工单
/reopen - 重开工单
/ban    - 封禁用户
/unban  - 解封用户
```

## 🔍 故障排查

### Bot 不回复？
```bash
# 1. 检查服务
docker-compose ps

# 2. 查看日志
docker-compose logs bot | tail -50

# 3. 重启服务
docker-compose restart bot
```

### AI 不工作？
```bash
# 检查配置
grep use_llm config/config.yaml  # 应为 true
grep llm_api_key config/config.yaml

# 查看 AI 日志
docker-compose logs bot | grep -i openai
```

### 客服组收不到消息？
- 检查群组 ID: `grep staffchat_id config/config.yaml`
- 确认机器人在群组中
- 确认机器人是管理员

## 📊 系统监控

### 查看运行状态
```bash
# 容器状态
docker-compose ps

# 资源使用
docker stats

# 实时日志
docker-compose logs -f
```

### 数据备份
```bash
# 备份 MongoDB
docker exec support-bot-mongodb mongodump --out /data/db/backup

# 复制到本地
docker cp support-bot-mongodb:/data/db/backup ./backup-$(date +%Y%m%d)

# 备份配置
cp config/config.yaml config/config.backup-$(date +%Y%m%d).yaml
```

## 🎨 自定义优化

### 调整 AI 行为

编辑 `config/config.yaml`:

```yaml
llm_knowledge: |
  你是「优质三方会员服务应用」官方 AI 客服小安。
  
  # 在这里添加：
  - 公司政策
  - 服务条款
  - 常见问题答案
  - 专业术语解释
```

### 添加自动回复

```yaml
autoreply:
  - question: '关键词1|关键词2'
    answer: '固定回复内容'
```

### 优化防刷屏

```yaml
spam_time: 30000      # 降低到 30 秒
spam_cant_msg: 3      # 减少到 3 条
```

## 📈 性能优化建议

### 降低 OpenAI 成本
1. 增加关键词自动回复覆盖率
2. 优化 `llm_knowledge` 内容（精简 prompt）
3. 定期分析高频问题，添加到自动回复

### 提升响应速度
1. 使用 gpt-4o-mini（已配置，最快最省）
2. 部署到网络较好的服务器
3. 考虑使用 CDN 加速 API 请求

### 减少人工工作量
1. 完善 AI 知识库
2. 训练 AI 识别更多场景
3. 设置自动关闭旧工单
4. 使用分类系统分流工单

## 🔗 相关链接

- [官方项目](https://github.com/bostrot/telegram-support-bot)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [OpenAI API 文档](https://platform.openai.com/docs)
- [Docker 文档](https://docs.docker.com/)

## 📞 技术支持

### 遇到问题？
1. 查看 `使用指南.md` 故障排查章节
2. 查看日志: `docker-compose logs bot`
3. 重启服务: `docker-compose restart`
4. 查看官方文档和 Issues

### 优化建议？
- 根据使用情况调整 AI prompt
- 添加更多自动回复规则
- 优化工单分类
- 定期分析用户反馈

## 🎓 学习资源

### 入门教程
- 如何创建 Telegram Bot
- Docker 基础知识
- MongoDB 数据库操作
- OpenAI API 使用

### 进阶技能
- Prompt Engineering（提示词工程）
- 客服系统设计
- 用户体验优化
- 数据分析与报表

---

## ✅ 项目完成度

- [x] Docker 环境配置
- [x] Telegram Bot 集成
- [x] OpenAI AI 助手配置
- [x] MongoDB 数据库部署
- [x] 工单系统设置
- [x] 自动回复配置
- [x] 中文界面本地化
- [x] 启动脚本准备
- [x] 文档编写完成

## 🎉 下一步

**现在可以启动测试了！**

```bash
cd telegram-bot
./start.sh
```

按照 `测试清单.md` 进行全面测试，确保所有功能正常工作。

---

**配置完成时间：** 2025-11-15  
**项目状态：** ✅ 就绪，可以启动  
**版本：** v1.0  
**维护人员：** @San-quan
