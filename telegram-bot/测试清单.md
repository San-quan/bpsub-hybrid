# ✅ 测试清单

## 启动前检查

- [x] Bot Token 已配置: `8584335653:AAFxKjEZBD-w98XJG26TmxaliC-Yb5`
- [x] 管理员 ID 已配置: `6919196077`
- [x] 客服群组 ID 已配置: `-10034038523`
- [x] OpenAI API Key 已配置
- [x] AI 已启用: `use_llm: true`
- [x] 配置文件已创建: `config/config.yaml`

## 启动服务

```bash
cd telegram-bot
./start.sh
```

或手动启动：
```bash
docker-compose up -d
```

查看日志：
```bash
docker-compose logs -f bot
```

## 测试步骤

### 1️⃣ 用户端测试（5 分钟）

**步骤 1: 启动对话**
- [ ] 在 Telegram 搜索你的机器人（根据 @BotFather 给你的 username）
- [ ] 发送 `/start`
- [ ] ✅ 应收到 AI 客服小安的欢迎消息

**步骤 2: 测试命令**
- [ ] 发送 `/help` → 应显示帮助信息
- [ ] 发送 `/faq` → 应显示常见问题
- [ ] 发送 `/id` → 应显示你的 Telegram ID

**步骤 3: 测试自动回复**
- [ ] 发送 `你好` → 应收到关键词自动回复
- [ ] 发送 `注册会员` → 应收到注册引导
- [ ] 发送 `退款` → 应收到退款流程说明

**步骤 4: 测试 AI 智能回复**
- [ ] 发送复杂问题（例如："我昨天注册的会员，今天想退款，需要什么资料？"）
- [ ] ✅ 应收到 AI 生成的详细回复
- [ ] ✅ 回复中应包含【客服记录表】标记

### 2️⃣ 客服端测试（5 分钟）

**步骤 1: 查看工单**
- [ ] 进入客服群组（ID: -10034038523）
- [ ] ✅ 应该看到刚才用户的消息被转发过来
- [ ] ✅ 消息包含工单号（例如：工单 #T000001）
- [ ] ✅ 消息显示用户信息

**步骤 2: 测试人工回复**
- [ ] 在群组中**回复**（Reply）用户的消息
- [ ] 输入："您好，人工客服为您服务"
- [ ] ✅ 用户端应该收到这条回复

**步骤 3: 测试客服命令**
- [ ] 在群组发送 `/open` → 应显示所有未处理工单
- [ ] 在群组回复某个工单后发送 `/close` → 应关闭该工单
- [ ] 在群组发送 `/id` → 应显示群组 ID

### 3️⃣ AI 功能测试（10 分钟）

**测试场景 1: 会员注册**
```
用户: 我想注册会员
AI: [应引导提供邮箱]
用户: 我的邮箱是 test@example.com
AI: [应确认信息并生成注册表]
```

**测试场景 2: 退款申请**
```
用户: 我要退款
AI: [应询问订单号和原因]
用户: 订单号12345，不想用了
AI: [应记录信息并生成退款表]
```

**测试场景 3: 价格咨询**
```
用户: 多少钱？
AI: [应提示联系管理员，因为价格不确定]
```

**测试场景 4: 转人工**
```
用户: 我要人工客服
AI: [应提示已通知管理员]
客服群组: [应收到转人工提示]
```

## 验收标准

### ✅ 必须通过
- [ ] 用户发送消息，客服组能收到
- [ ] 客服回复消息，用户能收到
- [ ] AI 能自动回复简单问题
- [ ] 工单号正常显示和追踪
- [ ] 日志无严重错误

### ⚠️ 建议优化（可选）
- [ ] AI 回复质量满意
- [ ] 响应速度 < 3 秒
- [ ] 自动回复覆盖率 > 50%
- [ ] 无垃圾消息误触发

## 常见问题快速修复

### ❌ Bot 完全不回复
```bash
# 1. 检查服务状态
docker-compose ps

# 2. 如果未运行，启动服务
docker-compose up -d

# 3. 查看错误日志
docker-compose logs bot | tail -50
```

### ❌ 客服组收不到消息
```bash
# 检查群组 ID 是否正确（必须是负数）
grep staffchat_id config/config.yaml

# 确认机器人在群组中且为管理员
# 进入群组 → 点击群组名称 → 成员列表 → 找到机器人
```

### ❌ AI 不回复
```bash
# 检查 AI 是否启用
grep use_llm config/config.yaml  # 应为 true

# 检查 API Key
grep llm_api_key config/config.yaml

# 查看 AI 日志
docker-compose logs bot | grep -i "openai\|gpt\|llm"
```

### ❌ 回复有延迟
```bash
# 检查网络
docker exec telegram-support-bot ping -c 3 api.telegram.org

# 检查 OpenAI API
docker exec telegram-support-bot ping -c 3 api.openai.com

# 查看资源使用
docker stats
```

## 测试通过后

### 1. 备份配置
```bash
cp config/config.yaml config/config.backup.yaml
```

### 2. 设置开机自启动
```bash
# 在 docker-compose.yml 中已设置 restart: unless-stopped
# 服务会在系统重启后自动启动
```

### 3. 定期维护
```bash
# 每周查看日志
docker-compose logs --tail=100 bot

# 每月备份数据
docker exec support-bot-mongodb mongodump --out /data/db/backup
```

---

## 🎉 测试完成标记

- [ ] 用户端功能全部正常
- [ ] 客服端功能全部正常  
- [ ] AI 回复质量满意
- [ ] 性能表现良好
- [ ] 配置已备份

**测试完成时间：** ________________

**测试人员签名：** ________________

**备注：**
